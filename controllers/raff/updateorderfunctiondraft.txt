// export const updateOrder = async (req, res) => {
//   try {
//     const { id } = req.params
//     const { status, paymentStatus } = req.body

//     const updateData = {}
//     if (status) updateData.status = status
//     if (paymentStatus) updateData.paymentStatus = paymentStatus

//     const order = await Order.findByIdAndUpdate(id, updateData, { new: true })

//     if (!order) {
//       return res.status(404).json({ message: "Order not found" })
//     }

    
//     if (status === "shipped" && !order.pathaoOrderId) {
//       try {
//         console.log('Creating Pathao order for:', order.orderNumber);
        
//         const pathaoRes = await createPathaoOrder(order)

//         order.pathaoTrackingId = pathaoRes.data.consignment_id
//         order.pathaoOrderId = pathaoRes.data.order_id
//         order.pathaoStatus = pathaoRes.data.status

//         await order.save()
//         console.log("Pathao order created successfully:", pathaoRes.data)
        
//       } catch (err) {
//         console.error("❌ Pathao order creation failed:", err.message)
        
//         // ✅ FIXED: PATHAO_BASE_URL is now defined
//         if (PATHAO_BASE_URL.includes('sandbox')) {
//           console.log('Sandbox environment - creating mock Pathao data');
          
//           // Mock data for sandbox testing
//           order.pathaoTrackingId = `PATH-SANDBOX-${Date.now()}`;
//           order.pathaoOrderId = `PATH-ORDER-${Date.now()}`;
//           order.pathaoStatus = 'pending';
//           order.pathaoSandboxMode = true;
          
//           await order.save();
//           console.log('✅ Mock Pathao data created for sandbox testing');
//         } else {
//           // Production error handling
//           order.pathaoError = err.message;
//           await order.save();
//         }
//       }
//     }

//     res.status(200).json({
//       status: "success",
//       message: "Order updated successfully",
//       data: { order },
//     })
//   } catch (error) {
//     console.error("Update order error:", error)
//     res.status(500).json({ message: "Internal server error", error: error.message })
//   }
// }
